<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YESINYERANG</title>
    <link rel="stylesheet" th:href="@{/css/default.css}">
    <link rel="stylesheet" th:href="@{/css/user/common.css}">
    <link rel="stylesheet" th:href="@{/css/user/search.css}">
</head>
<body>
<div class="wrapper">
    <!-- HEADER -->
    <div th:replace="user/layout/header.html"></div>
    <!-- //HEADER -->

    <!-- contents -->
    <div class="search_cont">
        <!-- "키워드" 검색결과 (갯수) -->
        <div class="keyword_result">
            <p th:text="'&quot;' + ${keyword} + '&quot; 검색 결과'"></p>
            <!-- 검색 결과 게시글 수 -->
            <span th:text="${count}"></span>
        </div>
        <!-- 제목, 내용 버튼 & 검색창 -->
        <div class="searchType_searchBox">
            <div class="button_box">
                <form class="search_bar" th:action="@{/search}" method="get">
                    <input type="hidden" name="searchType" value="">
                    <input type="hidden" name="keyword" th:value="${keyword}">
                    <button type="submit" class="search-btn" id="allBtn" th:classappend="${searchType == '' ? 'active' : ''}">제목+내용</button>
                </form>
            </div>
            <div class="button_box">
                <form class="search_bar" th:action="@{/search}" method="get">
                    <input type="hidden" name="searchType" value="title">
                    <input type="hidden" name="keyword" th:value="${keyword}">
                    <button type="submit" class="search-btn" id="titleBtn" th:classappend="${searchType == 'title' ? 'active' : ''}">제목</button>
                </form>
            </div>
            <div class="button_box">
                <form class="search_bar" th:action="@{/search}" method="get">
                    <input type="hidden" name="searchType" value="context">
                    <input type="hidden" name="keyword" th:value="${keyword}">
                    <button type="submit" class="search-btn" id="contentBtn" th:classappend="${searchType == 'context' ? 'active' : ''}">내용</button>
                </form>
            </div>
            <div></div>
        </div>
        <!-- 게시글 리스트 -->
        <div style="padding-top: 20px; padding-bottom: 60px">
            <div th:each="post : ${postList}">
                <div  style="border: 1px solid #D9DAF1; border-radius: 12px; margin-bottom: 24px; padding: 10px; cursor: pointer">
                    <div th:attr="onclick='redirectToDetailPage(\'' + ${post.mainCategory} + '\', \'' + ${post.postCode} + '\')'">

                        <!-- 이미지 -->
                        <div></div>
                        <!-- 내용 -->
                        <p th:text="${post.mainCategory}"></p>
                        <p th:text="${post.postTitle}"></p>
                        <p th:text="${#strings.length(post.postContext) &gt; 100} ? ${#strings.substring(post.postContext, 0, 99) + '...'} : ${post.postContext}"></p>
                        <div>
                            <p th:text="${post.member.nickname}"></p>
                            <p>조회<span class="eng" th:text="${post.viewCount}"></span></p>
                            <p class="eng"><span th:text="${#dates.format(post.postDate, 'yyyy-MM-dd')}"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div th:replace="user/layout/footer.html"></div>
    <!-- //FOOTER -->
</div>
<script th:src="@{/js/common.js}"></script>
<script th:inline="javascript">
    // 페이지 로드 시 활성화 버튼에 스타일 적용
    document.addEventListener("DOMContentLoaded", function(event) {
        var searchType = /* 서버에서 전달한 활성화된 버튼 타입 */;
        setActiveButton(searchType);
    });

    // 클릭된 버튼에 스타일 적용
    function setActiveButton(buttonId) {
        var buttons = document.querySelectorAll('.search-btn');
        buttons.forEach(function(button) {
            button.classList.remove('active');
        });

        var activeButton = document.getElementById(buttonId);
        if (activeButton) {
            activeButton.classList.add('active');
        }
    }

    // 클릭된 버튼의 스타일 초기화 및 활성 버튼 설정
    document.querySelectorAll('.search-bar').forEach(function(form) {
        form.addEventListener('submit', function(event) {
            var buttonId = event.submitter.id;
            setActiveButton(buttonId);
        });
    });



    function redirectToDetailPage(mainCategory, postCode) {
        var url;
        switch (mainCategory) {
            case '리뷰':
                url = '/board/reviewDetail?id=' + postCode;
                break;
            case '자유':
                url = '/board/freeDetail?id=' + postCode;
                break;
            case '매거진':
                url = '/board/magazinedetail?id=' + postCode;
                break;
        }
        if (url) {
            location.href = url;
        }
    }
</script>

</body>
</html>