<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<script>
    const totalConfirm = {
        trmconfirmchk : false,
        idconfirmchk : false,
        pwdconfirmchk : false,
        nknconfirmchk : false,
        emconfirmchk : false,
        gdconfirmchk : false,
    };

    $(document).ready(function () {
        $("#agree").click(function(){
            if($("#agree").is(':checked')){
                totalConfirm.trmconfirmchk = true;
            } else {
                totalConfirm.trmconfirmchk = false;
            }
        })


        $("#checkId").click(function() {
            // 아이디 값을 가져온다.
            var id = $("#memberId").val();

            if( id === '' ) {
                alert("아이디를 입력해주세요.");
                $("#memberId").focus();
            } else {
                // Fetch를 이용하여 요청을 보낸다.
                fetch("/request-dupCheck-id", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(id)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    // 성공적인 응답을 처리한다.
                    // console.log(data);
                    chkDupIdConfirm(data, $("#idTxt"));
                })
                .catch(error => {
                    // 오류가 발생했을 때 처리한다.
                    console.error("Error:", error);
                });
            }
        });

        $("#password").keyup(function () {
            var value = $(event.target).val();

            var num = value.search(/[0-9]/g);
            var eng = value.search(/[a-z]/ig);
            var spe = value.search(/[`~!@#$%^&*|\\\'\";:\/?]/gi);

            if(value.length < 8 || value.length > 30) {
                $("#pwdTxt").css({
                    "color" : "#FA3E3E",
                    "font-weight" : "bold",
                    "font-size" : "10px"
                });
                $("#pwdTxt").text("! 비밀번호는 8자리 이상 30자리 이하여야 합니다");
                totalConfirm.pwdconfirmchk = false;
            } else if (num < 0 || eng < 0 || spe < 0){
                $("#pwdTxt").css({
                    "color" : "#FA3E3E",
                    "font-weight" : "bold",
                    "font-size" : "10px"
                });
                $("#pwdTxt").text("! 비밀번호는 공백없이 영어+숫자+특수문자로 이루어져야 합니다");
                totalConfirm.pwdconfirmchk = false;
            } else {
                $("#pwdTxt").css({
                    "color" : "#6667AB",
                    "font-weight" : "bold",
                    "font-size" : "10px"
                });
                $("#pwdTxt").text("✅ 사용가능한 비밀번호입니다");
                totalConfirm.pwdconfirmchk = true;
            }
        })

        $("#checkNkname").click(function() {
            // 닉네임 값을 가져온다.
            var nickname = $("#nickname").val();

            if( nickname === '' ) {
                alert("닉네임을 입력해주세요.");
                $("#nickname").focus();
            } else {
                // Fetch를 이용하여 요청을 보낸다.
                fetch("/request-dupCheck-nickname", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(nickname)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Network response was not ok");
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 성공적인 응답을 처리한다.
                        // console.log(data);
                        chkDupNknConfirm(data, $("#nicknameTxt"));
                    })
                    .catch(error => {
                        // 오류가 발생했을 때 처리한다.
                        console.error("Error:", error);
                    });
            }
        });

        $("#checkEmail").click(function() {
            // 이메일 값을 가져온다.
            var email = $("#memail").val();

            if( email === '') {
                alert("이메일을 입력해주세요.");
                $("#memail").focus();
            } else {
                // Fetch를 이용하여 요청을 보낸다.
                fetch("/request-verify-mail", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(email)
                })
                    .then(response => {
                        if (!response.ok) {
                            alert("유효한 이메일이 아닙니다.")
                            throw new Error("Network response was not ok");
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 성공적인 응답을 처리한다.
                        // console.log(data);
                        alert("해당 이메일로 인증번호 발송이 완료되었습니다. \n 확인부탁드립니다.");
                        chkEmailConfirm(data, $("#memailconfirm"), $("#memailconfirmTxt"));
                    })
                    .catch(error => {
                        // 오류가 발생했을 때 처리한다.
                        console.error("Error:", error);
                    });
            }
        })

        $("#verifyFile").change(function() {

            // 파일을 가져온다.
            var file = event.target.files[0];
            // console.log(file);

            // formData객체에 파일(MultipartFile)형태 그대로 담는다
            var formData = new FormData();
            formData.append("file",file);
            // console.log(formData.get("file"));

            // Fetch를 이용하여 요청을 보낸다.
            fetch("/request-verify-wedd", {
                method: "POST",
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .catch(error => {
                    // 오류가 발생했을 때 처리한다.
                    console.error("Error:", error);
                });
        })

        // 성별 하나만 체크 가능
        $('input[type="checkbox"][name="gender"]').click(function(){
            if($(this).prop('checked')){
                $('input[type="checkbox"][name="gender"]').prop('checked',false);
                $(this).prop('checked',true);
                totalConfirm.gdconfirmchk = true;
            } else {
                totalConfirm.gdconfirmchk = false;
            }
            // console.log(totalConfirm.gdconfirmchk);
        });

        // 결혼여부 하나만 체크 가능
        $('input[type="checkbox"][name="verifyMarried"]').click(function(){
            if($(this).prop('checked')){
                $('input[type="checkbox"][name="verifyMarried"]').prop('checked',false);
                $(this).prop('checked',true);
            }
        });

    });

    // 아이디 중복확인 함수
    function chkDupIdConfirm(data, $idTxt){
        if (data != 0) {
            totalConfirm.idconfirmchk = false;
            $idTxt.html("<span id='idconfirmchk'>이미 사용중인 아이디입니다</span>")
            $("#idconfirmchk").css({
                "color" : "#FA3E3E",
                "font-weight" : "bold",
                "font-size" : "10px"
            })
        } else {
            totalConfirm.idconfirmchk = true;
            $idTxt.html("<span id='idconfirmchk'>사용 가능한 아이디입니다</span>")

            $("#idconfirmchk").css({
                "color" : "#6667AB",
                "font-weight" : "bold",
                "font-size" : "10px"
            })
        }
    }

    // 닉네임 중복확인 함수
    function chkDupNknConfirm(data, $nicknameTxt){
        if (data != 0) {
            totalConfirm.nknconfirmchk = false;
            $nicknameTxt.html("<span id='nknconfirmchk'>이미 사용중인 별명입니다</span>")
            $("#nknconfirmchk").css({
                "color" : "#FA3E3E",
                "font-weight" : "bold",
                "font-size" : "10px"
            })
        } else {
            totalConfirm.nknconfirmchk = true;
            $nicknameTxt.html("<span id='nknconfirmchk'>사용 가능한 별명입니다</span>")

            $("#nknconfirmchk").css({
                "color" : "#6667AB",
                "font-weight" : "bold",
                "font-size" : "10px"
            })
        }
    }

    // 이메일 인증번호 함수
    function chkEmailConfirm(data, $memailconfirm, $memailconfirmTxt){
        $memailconfirm.on("keyup", function(){
            if (data != $memailconfirm.val()) {
                totalConfirm.emconfirmchk = false;
                $memailconfirmTxt.html("<span id='emconfirmchk'>인증번호가 잘못되었습니다</span>")
                $("#emconfirmchk").css({
                    "color" : "#FA3E3E",
                    "font-weight" : "bold",
                    "font-size" : "10px"
                })
            } else {
                totalConfirm.emconfirmchk = true;
                $memailconfirmTxt.html("<span id='emconfirmchk'>인증번호 확인 완료</span>")

                $("#emconfirmchk").css({
                    "color" : "#6667AB",
                    "font-weight" : "bold",
                    "font-size" : "10px"
                })
            }
        })
    }
</script>
<body>
    <h1 style="text-align: center">회원가입</h1>
    <h3 style="padding-left: 60px">회원가입 약관 동의 <span style="color: #FA3E3E">(필수)</span></h3>
    <div style="text-align: center">
        <textarea name="terms" style="width: 800px; height: 224px" readonly>대충 약관</textarea>
        <div><input type="checkbox" name="agree" id="agree">동의합니다</div>
    </div>
    <br>
    <hr>
    <br>
    <div style="text-align: center">
        <span style="color: #FA3E3E">*</span>
        <span>아이디</span>
        <input type="text" name="memberId" id="memberId" placeholder="아이디를 입력해주세요">
        <button type="button" id="checkId">중복확인</button>
    </div>
    <div style="text-align: center">
        <label for="memberId" id="idTxt"></label>
    </div>
    <br>
    <div style="text-align: center">
        <span style="color: #FA3E3E">*</span>
        <span>비밀번호</span>
        <input type="password" name="password" id="password" placeholder="비밀번호를 입력해주세요"/>
    </div>
    <div style="text-align: center">
        <label for="password" id="pwdTxt" style="font-weight:bold; font-size: 10px">*영문,숫자,특수문자 조합 8자 이상 입력해 주세요</label>
    </div>
    <br>
    <div style="text-align: center">
        <span style="color: #FA3E3E">*</span>
        <label>닉네임</label>
        <input type="text" name="nickname" id="nickname" placeholder="닉네임을 입력해주세요"/>
        <button type="button" id="checkNkname">중복확인</button>
    </div>
    <div style="text-align: center">
        <label for="nickname" id="nicknameTxt"></label>
    </div>
    <br>
    <div style="text-align: center">
        <span style="color: #FA3E3E">*</span>
        <span>이메일 </span>
        <input type="text" name="memail" id="memail">
        <button type="button" id="checkEmail">인증번호</button>
    </div>
    <div style="text-align: center">
        <label for="memail" id="mailTxt"></label>
    </div>
    <br>
    <div style="text-align: center">
        <span style="color: #FA3E3E">*</span>
        <span>이메일 인증번호</span>
        <input type="text" id="memailconfirm">
    </div>
    <div style="text-align: center">
        <label for="memailconfirm" id="memailconfirmTxt"></label>
    </div>
    <br>
    <div style="text-align: center">
        <span>전화번호</span>
        <input type="text" id="phone">
    </div>
    <div style="text-align: center">
        <label for="phone" id="phoneTxt"></label>
    </div>
    <br>
    <div style="text-align: center">
        <span style="color: #FA3E3E">*</span>
        <span>성별</span>
        <input type="checkbox" name="gender" id="male" value="male">
        <label for="male">남자</label>
        <input type="checkbox" name="gender" id="female" value="female">
        <label for="female">여자</label>
    </div>
    <br>
    <div style="text-align: center">
        <span>결혼 여부</span>
        <input type="checkbox" name="verifyMarried" id="married" value="married">
        <label for="married">기혼</label>
        <input type="checkbox" name="verifyMarried" id="single" value="single">
        <label for="single">미혼</label>
    </div>
    <br>
    <div style="text-align: center">
        <span>웨딩홀 인증</span>
        <input type="file" name="verifyFile" id="verifyFile">
    </div>
    <div style="text-align: center">
        <label for="verifyFile" id="wedTxt" style="font-weight:bold; font-size: 10px">*웨딩홀 인증은 리뷰글 작성시 필요한 항목입니다</label>
    </div>
    <hr/>
    <br>
    <div style="text-align: center">
        <button>가입</button>
        <a href="/" style="text-decoration-line: none"><button>취소</button></a>
    </div>

<!--    <form th:action="@{/request-verify-mail}" method="post">-->
<!--        <input name="email" placeholder="이메일 주소">이메일-->
<!--        <button>발송</button>-->
<!--    </form>-->


</body>
</html>